<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Unzer\PAPI\Api\CheckoutInterface" type="Unzer\PAPI\Api\Checkout"/>

    <virtualType name="Unzer\PAPI\Logger\Logger" type="\Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="name" xsi:type="string">unzer</argument>
            <argument name="handlers" xsi:type="array">
                <item name="debug" xsi:type="object">Unzer\PAPI\Model\Logger\Handler\Debug</item>
            </argument>
        </arguments>
    </virtualType>
    <type name="Unzer\PAPI\Model\Logger\DebugHandler">
        <arguments>
            <argument name="logger" xsi:type="object">Unzer\PAPI\Logger\Logger</argument>
        </arguments>
    </type>

    <type name="Unzer\PAPI\Controller\Webhooks\Process">
        <arguments>
            <argument name="logger" xsi:type="object">Unzer\PAPI\Logger\Logger</argument>
        </arguments>
    </type>

    <type name="Unzer\PAPI\Model\Command\AbstractCommand">
        <arguments>
            <argument name="logger" xsi:type="object">Unzer\PAPI\Logger\Logger</argument>
        </arguments>
    </type>

    <virtualType name="UnzerAuthorizeAndCaptureCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">Unzer\PAPI\Model\Command\Authorize</item>
                <item name="cancel" xsi:type="string">Unzer\PAPI\Model\Command\Cancel</item>
                <item name="capture" xsi:type="string">Unzer\PAPI\Model\Command\Capture</item>
                <item name="order" xsi:type="string">Unzer\PAPI\Model\Command\Order</item>
                <item name="refund" xsi:type="string">Unzer\PAPI\Model\Command\Refund</item>
                <item name="refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Command\Refund</item>
                <item name="void" xsi:type="string">Unzer\PAPI\Model\Command\Cancel</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerCaptureCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="cancel" xsi:type="string">Unzer\PAPI\Model\Command\Cancel</item>
                <item name="capture" xsi:type="string">Unzer\PAPI\Model\Command\Capture</item>
                <item name="order" xsi:type="string">Unzer\PAPI\Model\Command\Order</item>
                <item name="refund" xsi:type="string">Unzer\PAPI\Model\Command\Refund</item>
                <item name="refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Command\Refund</item>
                <item name="void" xsi:type="string">Unzer\PAPI\Model\Command\Cancel</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- must be configured to avoid DI compilation errors since Base is interpreted as a normal payment method
         and thus requires a configuration, even though it is not used as payment method -->
    <virtualType name="UnzerBaseConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_BASE</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerBaseConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerBaseConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerBaseValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerBaseConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerBaseValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerBaseConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerBaseValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerBaseValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Base">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_BASE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerBaseValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerBaseValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerAuthorizeAndCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerCardsConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_CARDS</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerCardsConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerCardsConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerCardsValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerCardsConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerCardsValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerCardsConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerCardsValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerCardsValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Cards">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_CARDS</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerCardsValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerCardsValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerAuthorizeAndCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerDirectDebitConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_DIRECT_DEBIT</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerDirectDebitConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerDirectDebitConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerDirectDebitConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerDirectDebitValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\DirectDebit">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_DIRECT_DEBIT</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerDirectDebitValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerDirectDebitValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerDirectDebitSecuredConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_DIRECT_DEBIT_SECURED</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitSecuredConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerDirectDebitSecuredConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitSecuredValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerDirectDebitSecuredConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitSecuredValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerDirectDebitSecuredConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerDirectDebitSecuredValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerDirectDebitSecuredValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\DirectDebitSecured">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_DIRECT_DEBIT_SECURED</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerDirectDebitSecuredValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerDirectDebitSecuredValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerFlexipayDirectConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_BANK_TRANSFER</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerFlexipayDirectConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerFlexipayDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerFlexipayDirectValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerFlexipayDirectConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerFlexipayDirectValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerFlexipayDirectConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerFlexipayDirectValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerFlexipayDirectValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\BankTransfer">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_BANK_TRANSFER</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerFlexipayDirectValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerFlexipayDirectValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerIdealConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_IDEAL</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerIdealConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerIdealConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerIdealValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerIdealConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerIdealValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerIdealConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerIdealValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerIdealValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Ideal">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_IDEAL</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerIdealValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerIdealValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerInvoiceConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerInvoiceConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerInvoiceConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_capture" xsi:type="string">Unzer\PAPI\Model\Config\InvoiceCaptureHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerInvoiceConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerInvoiceValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Invoice">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Unzer\PAPI\Block\Info\Invoice</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerInvoiceValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerInvoiceValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerInvoiceSecuredB2bConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE_SECURED_B2B</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredB2bConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerInvoiceSecuredB2bConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredB2bValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerInvoiceSecuredB2bConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_capture" xsi:type="string">Unzer\PAPI\Model\Config\InvoiceCaptureHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredB2bValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerInvoiceSecuredB2bConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredB2bValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerInvoiceSecuredB2bValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\InvoiceSecuredB2b">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE_SECURED_B2B</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Unzer\PAPI\Block\Info\InvoiceSecuredB2b</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerInvoiceSecuredB2bValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerInvoiceSecuredB2bValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerInvoiceSecuredConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE_SECURED</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerInvoiceSecuredConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerInvoiceSecuredConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_capture" xsi:type="string">Unzer\PAPI\Model\Config\InvoiceCaptureHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerInvoiceSecuredConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerInvoiceSecuredValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerInvoiceSecuredValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\InvoiceSecured">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_INVOICE_SECURED</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Unzer\PAPI\Block\Info\InvoiceSecured</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerInvoiceSecuredValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerInvoiceSecuredValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerPaypalConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_PAYPAL</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerPaypalConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerPaypalConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerPaypalValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerPaypalConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerPaypalValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerPaypalConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerPaypalValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerPaypalValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Paypal">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_PAYPAL</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerPaypalValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerPaypalValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerAuthorizeAndCaptureCommandPool</argument>
        </arguments>
    </type>

    <virtualType name="UnzerSofortConfig" type="Unzer\PAPI\Model\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_SOFORT</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerSofortConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">UnzerSofortConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerSofortValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">UnzerSofortConfigValueHandler</item>
                <item name="can_cancel" xsi:type="string">Unzer\PAPI\Model\Config\CanCancelHandler</item>
                <item name="can_refund" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_refund_partial_per_invoice" xsi:type="string">Unzer\PAPI\Model\Config\CanRefundHandler</item>
                <item name="can_void" xsi:type="string">Unzer\PAPI\Model\Config\CanVoidHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerSofortValidatorCountry" type="Unzer\PAPI\Model\Validator\CountryRestrictionValidator">
        <arguments>
            <argument name="config" xsi:type="object">UnzerSofortConfig</argument>
        </arguments>
    </virtualType>

    <virtualType name="UnzerSofortValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">UnzerSofortValidatorCountry</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Unzer\PAPI\Model\Method\Sofort">
        <arguments>
            <argument name="code" xsi:type="const">Unzer\PAPI\Model\Config::METHOD_SOFORT</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Magento\Payment\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">UnzerSofortValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">UnzerSofortValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">UnzerCaptureCommandPool</argument>
        </arguments>
    </type>
</config>